<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  
  <link rel="shortcut icon" href="../img/favicon.ico">
  <title>SAE J1939 - Touch Encoder Documentation</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700" />

  <link rel="stylesheet" href="../css/theme.css" />
  <link rel="stylesheet" href="../css/theme_extra.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css" />
  
  <script>
    // Current page data
    var mkdocs_page_name = "SAE J1939";
    var mkdocs_page_input_path = "comm_protocols/sae_j1939.md";
    var mkdocs_page_url = null;
  </script>
  
  <script src="../js/jquery-2.1.1.min.js" defer></script>
  <script src="../js/modernizr-2.8.3.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> Touch Encoder Documentation</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../index.html">HOME</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">FIRMWARE</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="#">RELEASES</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../firmware/released/released.html">RELEASED</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../firmware/development/development.html">DEVELOPMENT</a>
                </li>
    </ul>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">SOFTWARE</span></p>
                <ul class="current">
                    <li class="toctree-l1 current"><a class="reference internal current" href="#">GH-TE MX</a>
    <ul class="current">
                <li class="toctree-l2 current"><a class="reference internal current" href="#">COMMUNICATION</a>
    <ul class="current">
                <li class="toctree-l3 current"><a class="reference internal current" href="sae_j1939.html">SAE J1939</a>
    <ul class="current">
    <li class="toctree-l4"><a class="reference internal" href="#11-reference-documents">1.1 Reference Documents</a>
    </li>
    </ul>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="hidusb.html">HID USB</a>
                </li>
    </ul>
                </li>
    </ul>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../te_guide/te_guide.html">TE GUIDE</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Update</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="#">Firmware update</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../live_update.html">Live Update</a>
                </li>
    </ul>
                    </li>
                </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">Touch Encoder Documentation</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
        
          <li>COMMUNICATION &raquo;</li>
        
      
        
          <li>GH-TE MX &raquo;</li>
        
      
        
          <li>SOFTWARE &raquo;</li>
        
      
    
    <li>SAE J1939</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="1-overview">1. Overview</h1>
<p>This document describes the functionality and communication of the Grayhill Touch Encoder product.</p>
<h2 id="11-reference-documents">1.1 Reference Documents</h2>
<p>The following documents are referenced within this document.</p>
<ul>
<li>SAE-J1939</li>
<li>SAE-J1939/11</li>
<li>SAE-J1939/21</li>
<li>SAE-J1939/71</li>
<li>SAE-J1939/81</li>
</ul>
<h1 id="2-j1939-communications">2. J1939 Communications</h1>
<h2 id="21-message-header-description">2.1 Message Header Description</h2>
<p>The figure below illustrates the format of the CAN message ID. A brief description of each field follows.</p>
<p><img alt="j1939-can-id" src="images/canj1939_id_illustration.jpg" title="J1939 can id" /></p>
<h3 id="211-priority">2.1.1 Priority</h3>
<p>This 3-bit field is used to define the priority during arbitration. 0 is the highest priority and is usually associated with high-speed control messages. Low priority is used for non-critical configuration and information messages. The lowest priority value is 7.</p>
<h3 id="212-data-page-dp">2.1.2 Data Page (DP)</h3>
<p>This 1-bit field defines on which data page (0 or 1) the message is defined in the J1939 specification. Page 0 contains the messages that are presently defined, while Page 1 is for future expansion according to J1939.</p>
<h3 id="213-protocol-data-unit-pdu-pdu-format-pf">2.1.3 Protocol Data Unit (PDU) - PDU Format (PF)</h3>
<p>This 8-bit field determines the format of the message and is one of the fields which determine the Parameter Group Number of the message (see 2.1.6). If the value is between 0 and 239, the message is a PDU 1 format message. These messages are sent to specific addresses. If the value is between 240 and 255, the message is a PDU 2 format message. These messages are not sent to a specific address, but are instead broadcast to the entire network.</p>
<h3 id="214-protocol-data-unit-pdu-pdu-specific-ps">2.1.4 Protocol Data Unit (PDU) - PDU Specific (PS)</h3>
<p>The PDU Specific (PS) field is the Destination Address (DA) in a PDU 1 Format. In a PDU 2 format the PS becomes the Group Extension (GE). This field is 8 bits long.</p>
<h3 id="215-source-address">2.1.5 Source Address</h3>
<p>This 8-bit field is the source address of the device that sent the message.</p>
<h3 id="216-parameter-group-number">2.1.6 Parameter Group Number</h3>
<p>J1939 defines allowable messages by their Parameter Group Number (PGN). The Parameter Group Number is an 18-bit value that uniquely defines the message purpose. It is composed of the Reserved bit, DP, PF and PS, all of which are described above.</p>
<h2 id="22-j1939-bit-field-location-and-byte-ordering">2.2 J1939 Bit Field Location and Byte Ordering</h2>
<p>The first data byte is sent first and is referenced as Byte 1. The LSB of the data bytes are on the right and are referenced as Bit 1.</p>
<p>All multibyte data fields are specified in little-endian byte order unless stated otherwise.</p>
<p>The convention used to locate a parameter in the data field is the same as specified in SAE-J1939/71. The format used is &quot;R.x&quot; where R is the byte number and x is the starting bit number within the byte. The length is the number of bits starting at this point.</p>
<p><strong>Example</strong>: Location 4.3 with a length of 3 bits would have the value of 1 as illustrated below.</p>
<blockquote>
<p>Byte 4 = 0x67 = 0b011<strong>001</strong>11. The bold value is the three bit field holding a value of 0b001.</p>
</blockquote>
<p><strong>Example</strong>: Location 4.3 with a length of 3 bits would have the value of 6 as illustrated below.</p>
<blockquote>
<p>Byte 4 = 0x7b = 0b011<strong>110</strong>11. The bold value is the three bit field holding a value of 0b110.</p>
</blockquote>
<h2 id="23-grayhill-touch-encoder-source-address">2.3 Grayhill Touch Encoder Source Address</h2>
<p>The source address of the Grayhill Touch Encoder device is set to 242 (0xF2) at the factory. This may be modified dynamically with the proprietary Source Address Command. The source address value is stored in non-volatile memory. Touch Encoder assumes this value at startup but the actual source address is the result of Dynamic Addressing. Multiple Touch Encoder devices can coexist in the same system.</p>
<h2 id="24-standard-messages">2.4 Standard Messages</h2>
<p>The Events Data message and the Widget Data message all use the Proprietary B PDU2 format (PF = 255) that broadcasts to no specific address the status of the device. The Control Data message uses Proprietary A PDU1 format (PF = 239).</p>
<h3 id="241-events-data-message">2.4.1 Events Data Message</h3>
<pre><code>Priority – 0b110 (6)
R/DP – 0b00 (0)
PF – 0xFF (255), Proprietary B PDU2 Format
GrpExt – 0x0F (15)
SrcAddr – 0xF2 (242), i.e. Touch Encoder default source address
ID – 0x18FF0FF2
Direction – Transmit
Data Length – 8 bytes
Transmission Rate – On Event (programmable)
</code></pre>
<p>* The Events Data PGN can be reassigned using a configuration command.</p>
<table>
<thead>
<tr>
<th>Start</th>
<th>Length</th>
<th>Desc.</th>
<th>Values</th>
</tr>
</thead>
<tbody>
<tr>
<td>1.1</td>
<td>8 bits</td>
<td>Screen Number</td>
<td>0x01 – Screen #1 at the time of event</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td>…</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td>0xFF – Screen #255 at the time of event</td>
</tr>
<tr>
<td>2.1</td>
<td>8 bits</td>
<td>Reserved</td>
<td>Reserved for future use</td>
</tr>
<tr>
<td>3.1</td>
<td>8 bits</td>
<td>Event ID</td>
<td>0x01- Events: Standard (Relative Encoder, Taps, Swipes)</td>
</tr>
<tr>
<td>4.1</td>
<td>8 bits</td>
<td>Encoder (relative)</td>
<td>0x80 – No Change</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td>0x81 – Clockwise 1 detent</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td>0x82 – Clockwise 2 detents</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td>…</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td>0xFE – Clockwise 126 detents</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td>0x7F – Counter-Clockwise 1 detent</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td>0x7E – Counter-Clockwise 2 detents</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td>…</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td>0x01 – Counter-Clockwise 127 detents</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td>0x00 – Not used</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td>0xFF – Not used</td>
</tr>
<tr>
<td>5.1</td>
<td>16 bits</td>
<td>Tap Mask*</td>
<td>0x0000 – No Tap detected</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td>0x0001 – Tap in Zone 1 detected</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td>0x0002 – Tap in Zone 2 detected</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td>0x0004 – Tap in Zone 3 detected</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td>…</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td>0x4000 – Tap in Zone 15 detected</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td>0x8000 – Tap on screen (anywhere) detected</td>
</tr>
<tr>
<td>7.1</td>
<td>8 bits</td>
<td>Swipe Mask</td>
<td>0x00 – No Swipe detected</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td>0x01 – Swipe Up detected</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td>0x02 – Swipe Down detected</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td>0x04 – Swipe Left detected</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td>0x08 – Swipe Right detected</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td>0x80 – Swipe (any direction) detected</td>
</tr>
<tr>
<td>* This field is specified in big-endian byte order.</td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p>The Events Data message is sent to inform the receiving (host) ECU of any new events (encoder turn, tap or swipe) that occurred
on the Touch Encoder. If such an event causes a screen transistion or change to any of the current widgets Value IDs, the Event Data Message is followed by Widget Data message(s).</p>
<p><strong>Example</strong>: Turning the encoder counter-clockwise by 2 detents on screen 1 (since last message) will result in the following message being transmitted.</p>
<pre><code>ID=0x18FF0FF2, LEN=8, DATA=0x01,0x00,0x01,0x7E,0x00,0x00,0x00,0xFF
</code></pre>
<p><strong>Example</strong>: Swiping up on the touch pad on screen 5 will result in the following message being transmitted.</p>
<pre><code>ID=0x18FF0FF2, LEN=8, DATA=0x05,0x00,0x01,0x80,0x00,0x00,0x81,0xFF
</code></pre>
<p><strong>Example</strong>: Tapping in screen 10 zone 4 of the touch pad will result in the following message being transmitted.</p>
<pre><code>ID=0x18FF0FF2, LEN=8, DATA=0x0A,0x00,0x01,0x80,0x80,0x08,0x00,0xFF
</code></pre>
<h3 id="242-widget-data-message">2.4.2 Widget Data Message</h3>
<pre><code>Priority – 0b110 (6)
R/DP – 0b00 (0)
PF – 0xFF (255), Proprietary B PDU2 Format
GrpExt – 0x11 (17)
SrcAddr – 0xF2 (242), i.e. Touch Encoder default source address
ID – 0x18FF11F2
Direction – Transmit
Data Length – 8 bytes
Transmission Rate – On Event (programmable)
</code></pre>
<p>* The Widget Data PGN can be reassigned using a configuration command.</p>
<p>As described in the previous section, if an event on the Touch Encoder Device or Modify Widget Data Message causes a new widget to be displayed or if the event causes a change in one of the active Value IDs on the current widget, the Events Data message is immediately followed by Widget Data message(s).</p>
<p>For events or Modify Widget Data Messages that cause a screen transistion, Widget Reports for all active values IDs (i.e., value IDs configured to be used) on that widget will be sent. For events or Modify Widget Messages that cause a value change on the current widget, Widget Reports for only the changed values will be sent.</p>
<p>Due to CAN restrictions on the number of data bytes allowed per CAN frame, Widget Data Reports with multiple Value IDs need to be split up into several messages. The number of messages needed is equal to the number of Value IDs that need reporting. For instance, when tranistioning to a screen with a single active Value ID, only one message is needed. When transistioning to a screen with multiple active Value IDs, multiple messages are sent out consecutively for each active Value ID on that widget.</p>
<table>
<thead>
<tr>
<th>Start</th>
<th>Length</th>
<th>Desc.</th>
<th>Values</th>
</tr>
</thead>
<tbody>
<tr>
<td>1.1</td>
<td>8 bits</td>
<td>Screen Number</td>
<td>0x01 – Screen #1 currently being displayed</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td>…</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td>0xFF – Screen #255 currently being displayed</td>
</tr>
<tr>
<td>2.1</td>
<td>8 bits</td>
<td>Reserved</td>
<td>Reserved for future use</td>
</tr>
<tr>
<td>3.1</td>
<td>8 bits</td>
<td>Value ID</td>
<td>0x00 – No Values on this screen</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td>0x01 – Value ID #1</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td>0x02 – Value ID #2</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td>0x04 – Value ID #3</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td>…</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td>0x80 – Value ID #8</td>
</tr>
<tr>
<td>4.1</td>
<td>16 bits</td>
<td>Current Value</td>
<td>Value currently being displayed for the given Value ID</td>
</tr>
<tr>
<td>6.1</td>
<td>4 bits</td>
<td>Reserved</td>
<td>0</td>
</tr>
<tr>
<td>6.5</td>
<td>4 bits</td>
<td>Display Code</td>
<td>Display Code (Decimal Code) for this Value</td>
</tr>
<tr>
<td>7.1</td>
<td>8 bits</td>
<td>Active Value ID Bitmask</td>
<td>Mask for active/configured IDs on current widget. On screen</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td>change all active IDs will be set. On single ID change only</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td>that ID will be set.</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td>0x00 – Not used</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td>0x01 – Value ID (Value #1 is active for this screen)</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td>0x02 – Value ID (Value #2 is active for this screen)</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td>0x03 – Value ID (Value #1 and #2 are active for this screen)</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td>…</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td>0xFF – Value ID (All 8 Values active for this widget)</td>
</tr>
</tbody>
</table>
<p><strong>Example</strong>: For two active Value IDs, two separate messages are needed to convey all of the Widget information. Below is an example of the messages sent when transitioning to a widget that has two ValueIDs. The first being a temperature setting of 75 and the second being a fan speed of 5.</p>
<pre><code>ID=0x18FF11F2, LEN=8, DATA=0x01,0x00,0x01,0x4B,0x00,0x00,0x03,0xFF

ID=0x18FF11F2, LEN=8, DATA=0x01,0x00,0x02,0x05,0x00,0x00,0x03,0xFF
</code></pre>
<h3 id="243-configuration-and-control-message">2.4.3 Configuration and Control Message</h3>
<pre><code>Priority – 0b110 (6)
R/DP – 0b00 (0)
PF – 0xEF (239) Proprietary A PDU1 Format
PS – DestAddr, i.e. address of the Touch Encoder device, default value: 242 (0xF2)
SrcAddr – 0x21 (33), i.e. example source address
ID – 0x18EFF221
Direction – Receive
Data Length – 8
</code></pre>
<table>
<thead>
<tr>
<th>Start</th>
<th>Length</th>
<th>Desc.</th>
<th>Values</th>
</tr>
</thead>
<tbody>
<tr>
<td>1.1</td>
<td>1 Byte</td>
<td>Configuration and Control Command</td>
<td>Command Byte as described in sec. 3</td>
</tr>
<tr>
<td>2.1</td>
<td>7 Bytes</td>
<td>Configuration and Control Data</td>
<td>Variable as described in sec. 3</td>
</tr>
</tbody>
</table>
<h1 id="3-configuration-and-control-commands">3. Configuration and Control Commands</h1>
<p>Changing of the configuration and how the Touch Encoder device behaves is done with the Configuration and Control message described in section 2.4.3. The first byte serves as the command byte. Where applicable, changes take effect immediately and are stored in non-volatile memory unless otherwise noted.</p>
<p>The header information for these commands is as follows:</p>
<pre><code>Priority – 0b110 (6)
R/DP – 0b00 (0)
PF – 0xEF (239)
PS – DestAddr, i.e. address of the Touch Encoder device, default value: 0xF2 (242)
SrcAddr – 0x21 (33), i.e. example source address
ID – 0x18EFF221, Proprietary A PDU1 Format
Direction – Receive
</code></pre>
<h2 id="31-modify-widget-data">3.1 Modify Widget Data</h2>
<p>Data Length – 7 bytes</p>
<table>
<thead>
<tr>
<th>Start</th>
<th>Length</th>
<th>Desc.</th>
<th>Values</th>
</tr>
</thead>
<tbody>
<tr>
<td>1.1</td>
<td>8 bits</td>
<td>Command</td>
<td>0x11 – Force Widget Data</td>
</tr>
<tr>
<td>2.1</td>
<td>8 bits</td>
<td>Screen Number</td>
<td>0x00 – Screen #0 to be displayed</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td>0x01 – Screen #1 to be displayed</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td>…</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td>0xFF – Screen #255 to be displayed</td>
</tr>
<tr>
<td>3.1</td>
<td>8 bits</td>
<td>Value ID</td>
<td>0x00 – No altered Values</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td>0x01 – Value ID #1</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td>0x02 – Value ID #2</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td>0x04 – Value ID #3</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td>…</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td>0x80 – ValueID #8</td>
</tr>
<tr>
<td>4.1</td>
<td>16 bits</td>
<td>Current Value</td>
<td>Value to be displayed. This value is of the format specified by Display Code value</td>
</tr>
<tr>
<td>6.1</td>
<td>1 bit</td>
<td>Screen Transition Suppressor</td>
<td>0 – Perform screen transition</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td>1 – Suppress screen transition</td>
</tr>
<tr>
<td>6.2</td>
<td>3 bits</td>
<td>Reserved</td>
<td>0</td>
</tr>
<tr>
<td>6.5</td>
<td>4 bits</td>
<td>Display Code</td>
<td>Display Code for this Value (Decimal Code)</td>
</tr>
<tr>
<td>7.1</td>
<td>8 bits</td>
<td>Active Value ID Bitmask</td>
<td>0x00 – Not used</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td>0x01 – Value #1 currently active</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td>0x02 – Value #2 currently active</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td>…</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td>0x80 – All 8 Values currently active</td>
</tr>
</tbody>
</table>
<p><strong>Example</strong>: Sending the following message to a Touch Encoder device having the default address of 0xF2 will set the current screen to be displayed to 0x03 and the current value of ValueID #2 of that screen to 0x01F4.</p>
<pre><code>ID=18EFF221, LEN=8, Data=0x11, 0x03, 0x02, 0xF4, 0x01, 0x00, 0x02, 0xFF
</code></pre>
<h3 id="311-multi-value-data-example">3.1.1 Multi-Value Data Example</h3>
<p><img alt="multi-value-widget" src="images/multi_value_right_example.jpg" title="Multi-value Widget" /></p>
<p><strong>Example</strong>: The figure above displays an example of a multi-value widget. The dynamic text object is designated at Value ID #2. The lighted icon object is designated as Value ID #3. Below is the sequence of messages to turn on the top lighted icon and change the dynamic text to 100.</p>
<pre><code>ID=18EFF221, LEN=8, Data=0x11, 0x03, 0x04, 0x01, 0x00, 0x00, 0x06, 0xFF

ID=18EFF221, LEN=8, Data=0x11, 0x03, 0x02, 0x64, 0x00, 0x00, 0x06, 0xFF
</code></pre>
<h3 id="312-display-code">3.1.2 Display Code</h3>
<p>The Display Code gives the Touch Encoder the ability to display decimal numbers. The Display Code occupies 4 upper bits of byte 6. The value of this field is interpreted as a signed 4-bit integer that specifies the direction and the amount of decimal places to shift the point by. The alternative name for this field is Decimal Code. The table below describes how the decimal code works.</p>
<table>
<thead>
<tr>
<th>Decimal Code</th>
<th>Value</th>
<th>Display Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>0x0</td>
<td>1</td>
<td>1</td>
<td>Display value directly</td>
</tr>
<tr>
<td>0x1</td>
<td>1</td>
<td>10</td>
<td>value x 10 (shift right one place)</td>
</tr>
<tr>
<td>0x2</td>
<td>1</td>
<td>100</td>
<td>value x 100 (shift right two places)</td>
</tr>
<tr>
<td>0xE</td>
<td>1</td>
<td>0.01</td>
<td>value ÷ 100 (shift left two places)</td>
</tr>
<tr>
<td>0xF</td>
<td>1</td>
<td>0.1</td>
<td>value ÷ 10 (shift left one place)</td>
</tr>
</tbody>
</table>
<h3 id="313-screen-transition-suppression">3.1.3 Screen Transition Suppression</h3>
<p>The Screen Transition Suppressor (STS) enables the Touch Encoder to modify variable data of the target screen without first transitioning to that screen. If the corresponding bit is set, the Touch Encoder will not perform a screen transition prior to applying a data change.
This feature is available in Touch Encoder firmware version 3.1.0 or higher.</p>
<h2 id="32-modify-events-data-pgn">3.2 Modify Events Data PGN</h2>
<p>Data Length – 8 bytes</p>
<table>
<thead>
<tr>
<th>Byte 1</th>
<th>Byte 2</th>
<th>Byte 3</th>
<th>Byte 4</th>
<th>Byte 5</th>
<th>Byte 6</th>
<th>Byte 7</th>
<th>Byte 8</th>
</tr>
</thead>
<tbody>
<tr>
<td>0xD1</td>
<td>aa</td>
<td>bb</td>
<td>xx</td>
<td>xx</td>
<td>xx</td>
<td>0x55</td>
<td>0xAA</td>
</tr>
</tbody>
</table>
<p><strong>aa</strong> – The least significant byte of the new PGN. Valid Range: 0..255<br />
<strong>bb</strong> - The most significant byte of the new PGN. Valid Range: 0..255<br />
<strong>xx</strong> – Don&#39;t Care. Should be 0xFF following J1939 convention<br />
<strong>0x55</strong> – Low byte of 16 bit key<br />
<strong>0xAA</strong> – High byte of 16 bit key</p>
<h2 id="33-modify-events-data-transmission-period">3.3 Modify Events Data Transmission Period</h2>
<p>Data Length – 8 bytes</p>
<table>
<thead>
<tr>
<th>Byte 1</th>
<th>Byte 2</th>
<th>Byte 3</th>
<th>Byte 4</th>
<th>Byte 5</th>
<th>Byte 6</th>
<th>Byte 7</th>
<th>Byte 8</th>
</tr>
</thead>
<tbody>
<tr>
<td>0xD3</td>
<td>dd</td>
<td>Event</td>
<td>xx</td>
<td>xx</td>
<td>xx</td>
<td>0x55</td>
<td>0xAA</td>
</tr>
</tbody>
</table>
<p><strong>dd</strong> – specifies transmission period. Valid range is 0..255. The actual period is determined by multiplying the value by 10ms. This yields the minimum of 10ms and the maximum of 2.55 seconds. The value of 0 turns off periodic transmission of the message.<br />
<strong>Event</strong> – transmit on event. Valid values are 0 and 1. The value of 1 sends the message upon state change. The value of 0 will cause the message to be transmitted only at the specified time interval unless also set to 0.<br />
<strong>xx</strong> – Don&#39;t Care. Should be 0xFF following J1939 convention<br />
<strong>0x55</strong> – Low byte of 16 bit key<br />
<strong>0xAA</strong> – High byte of 16 bit key</p>
<h2 id="34-modify-widgets-data-pgn">3.4 Modify Widgets Data PGN</h2>
<p>Data Length – 8 bytes</p>
<table>
<thead>
<tr>
<th>Byte 1</th>
<th>Byte 2</th>
<th>Byte 3</th>
<th>Byte 4</th>
<th>Byte 5</th>
<th>Byte 6</th>
<th>Byte 7</th>
<th>Byte 8</th>
</tr>
</thead>
<tbody>
<tr>
<td>0xD9</td>
<td>aa</td>
<td>bb</td>
<td>xx</td>
<td>xx</td>
<td>xx</td>
<td>0x55</td>
<td>0xAA</td>
</tr>
</tbody>
</table>
<p><strong>aa</strong> – The least significant byte of the new PGN. Valid Range: 0..255<br />
<strong>bb</strong> - The most significant byte of the new PGN. Valid Range: 0..255<br />
<strong>xx</strong> – Don&#39;t Care. Should be 0xFF following J1939 convention<br />
<strong>0x55</strong> – Low byte of 16 bit key<br />
<strong>0xAA</strong> – High byte of 16 bit key</p>
<h2 id="35-modify-widgets-data-transmission-period">3.5 Modify Widgets Data Transmission Period</h2>
<p>Data Length – 8 bytes</p>
<table>
<thead>
<tr>
<th>Byte 1</th>
<th>Byte 2</th>
<th>Byte 3</th>
<th>Byte 4</th>
<th>Byte 5</th>
<th>Byte 6</th>
<th>Byte 7</th>
<th>Byte 8</th>
</tr>
</thead>
<tbody>
<tr>
<td>0xDB</td>
<td>dd</td>
<td>Event</td>
<td>xx</td>
<td>xx</td>
<td>xx</td>
<td>0x55</td>
<td>0xAA</td>
</tr>
</tbody>
</table>
<p><strong>dd</strong> – specifies transmission period. Valid range is 0..255. The actual period is determined by multiplying the value by 10ms. This yields the minimum of 10ms and the maximum of 2.55 seconds. The value of 0 turns off periodic transmission of the message.<br />
<strong>Event</strong> – transmit on event. Valid values are 0 and 1. The value of 1 sends the message upon state change. The value of 0 will cause the message to be transmitted only at the specified time interval unless also set to 0.<br />
<strong>xx</strong> – Don&#39;t Care. Should be 0xFF following J1939 convention<br />
<strong>0x55</strong> – Low byte of 16 bit key<br />
<strong>0xAA</strong> – High byte of 16 bit key</p>
<h2 id="36-modify-message-priority">3.6 Modify Message Priority</h2>
<p>Data Length – 8 bytes</p>
<table>
<thead>
<tr>
<th>Byte 1</th>
<th>Byte 2</th>
<th>Byte 3</th>
<th>Byte 4</th>
<th>Byte 5</th>
<th>Byte 6</th>
<th>Byte 7</th>
<th>Byte 8</th>
</tr>
</thead>
<tbody>
<tr>
<td>0xD2</td>
<td>dd</td>
<td>xx</td>
<td>xx</td>
<td>xx</td>
<td>xx</td>
<td>0x55</td>
<td>0xAA</td>
</tr>
</tbody>
</table>
<p><strong>dd</strong> – The new priority. Valid Range: 0..7<br />
<strong>xx</strong> – Don&#39;t Care. Should be 0xFF following J1939 convention<br />
<strong>0x55</strong> – Low byte of 16 bit key<br />
<strong>0xAA</strong> – High byte of 16 bit key</p>
<p>Applies to all messages sent by the Touch Encoder.</p>
<h3 id="37-modify-source-address">3.7 Modify Source Address</h3>
<p>Data Length – 8 bytes</p>
<table>
<thead>
<tr>
<th>Byte 1</th>
<th>Byte 2</th>
<th>Byte 3</th>
<th>Byte 4</th>
<th>Byte 5</th>
<th>Byte 6</th>
<th>Byte 7</th>
<th>Byte 8</th>
</tr>
</thead>
<tbody>
<tr>
<td>0xE0</td>
<td>dd</td>
<td>xx</td>
<td>xx</td>
<td>xx</td>
<td>xx</td>
<td>0x55</td>
<td>0xAA</td>
</tr>
</tbody>
</table>
<p><strong>dd</strong> – Has a value between 128 and 245 and is the new source address<br />
<strong>xx</strong> – Don&#39;t Care. Should be 0xFF following J1939 convention<br />
<strong>0x55</strong> – Low byte of 16 bit key<br />
<strong>0xAA</strong> – High byte of 16 bit key</p>
<h2 id="38-backlight-intensity">3.8 Backlight Intensity</h2>
<p>Data Length – 8 bytes</p>
<table>
<thead>
<tr>
<th>Byte 1</th>
<th>Byte 2</th>
<th>Byte 3</th>
<th>Byte 4</th>
<th>Byte 5</th>
<th>Byte 6</th>
<th>Byte 7</th>
<th>Byte 8</th>
</tr>
</thead>
<tbody>
<tr>
<td>0x80</td>
<td>xx</td>
<td>dd</td>
<td>xx</td>
<td>xx</td>
<td>xx</td>
<td>xx</td>
<td>xx</td>
</tr>
</tbody>
</table>
<p><strong>dd</strong> – Has a value between 0 and 100 and is the percentage of backlight intensity<br />
<strong>xx</strong> – Don&#39;t Care. Should be 0xFF following J1939 convention</p>
<h2 id="39-live-update-request">3.9 Live Update Request</h2>
<p>Data Length – 8 bytes</p>
<table>
<thead>
<tr>
<th>Start</th>
<th>Length</th>
<th>Desc.</th>
<th>Values</th>
</tr>
</thead>
<tbody>
<tr>
<td>1.1</td>
<td>1 Byte</td>
<td>Command</td>
<td>0x55 - Live Update Request</td>
</tr>
<tr>
<td>2.1</td>
<td>1 Byte</td>
<td>Component type</td>
<td>0 - package</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td>3 - project</td>
</tr>
<tr>
<td>3.1</td>
<td>3 Bytes</td>
<td>Upload Size</td>
<td>File size in bytes</td>
</tr>
<tr>
<td>6.1</td>
<td>3 Bytes</td>
<td>PGN</td>
<td>PGN value to use for the update session</td>
</tr>
</tbody>
</table>
<p><strong>Example</strong>: The following message requests the update of Touch Encoder project. The origin (0x21) obligates itself to upload a file of size equal to 2212495 bytes (roughly 2.11MB) over PGN 0x13300. The file, once succesfully submitted, will be used to update the TE project.</p>
<pre><code>ID=18EFF221, LEN=8, Data=0x55, 0x03, 0x8F, 0xC2, 0x21, 0x00, 0x33, 0x01
</code></pre>
<p>To learn more about the live update procedure, see our <a href="../live_update.html">Live Update guide</a>.</p>
<h1 id="4-other-j1939-messages">4. Other J1939 Messages</h1>
<p>The following messages are defined in the J1939 documents and are implemented in the Touch Encoder device.</p>
<h2 id="41-address-claimed">4.1 Address Claimed</h2>
<pre><code>Priority – 0b110 (6)
R/DP – 0b00 (0)
PF – 0xEE (238), Address Claimed
PS – DestAddr, address should always be the Global Address, 0xFF
SrcAddr – 0xF2 (242), i.e. Touch Encoder source address
ID – 0x18EEFFF2, Proprietary A PDU1 Format
Direction – Transmit
Data Length – 8 bytes
Transmission Rate – Upon boot or whenever requested
</code></pre>
<table>
<thead>
<tr>
<th>Start</th>
<th>Length</th>
<th>Desc.</th>
<th>Values</th>
</tr>
</thead>
<tbody>
<tr>
<td>1.1</td>
<td>21 Bits</td>
<td>Identity Number</td>
<td>Device-unique value</td>
</tr>
<tr>
<td>3.6</td>
<td>11 Bits</td>
<td>Manufacturers Code</td>
<td>294 (Assigned to Grayhill by SAE)</td>
</tr>
<tr>
<td>5.1</td>
<td>3 Bits</td>
<td>ECU Instance</td>
<td>0 (Default)</td>
</tr>
<tr>
<td>5.4</td>
<td>5 Bits</td>
<td>Function Instance</td>
<td>0 (Default)</td>
</tr>
<tr>
<td>6.1</td>
<td>8 Bits</td>
<td>Function</td>
<td>60 (Cab Display) *</td>
</tr>
<tr>
<td>7.1</td>
<td>1 Bit</td>
<td>Reserved</td>
<td>0 (Defined by SAE)</td>
</tr>
<tr>
<td>7.2</td>
<td>7 Bits</td>
<td>Vehicle System</td>
<td>0 (Default)</td>
</tr>
<tr>
<td>8.1</td>
<td>4 Bits</td>
<td>Vehicle System Instance</td>
<td>0 (Default)</td>
</tr>
<tr>
<td>8.5</td>
<td>3 Bits</td>
<td>Industry Group</td>
<td>0 Global (Default)</td>
</tr>
<tr>
<td>8.8</td>
<td>1 Bit</td>
<td>Arbitrary Address Capable</td>
<td>1 Capable (Default)</td>
</tr>
</tbody>
</table>
<p>*Refer to J1939 base document for the Function value based on the Industry Group and Vehicle System combinations</p>
<h2 id="42-pgn-request">4.2 PGN Request</h2>
<pre><code>Priority – 0b110 (6)
R/DP – 0b00 (0)
PF – 0xEA (234), PGN Request, Proprietary A PDU1 Format
PS – DestAddr, address of the Touch Encoder device to respond or the Global Address
SrcAddr – 0x21 (33), i.e. example source address
ID – 0x18EAF221
Direction –  Receive
Data Length – 3
</code></pre>
<table>
<thead>
<tr>
<th>Start</th>
<th>Length</th>
<th>Desc.</th>
<th>Values</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>1 Byte</td>
<td>Byte 1 of PGN being requested (LSB)</td>
<td>0 to 255</td>
</tr>
<tr>
<td>2</td>
<td>1 Byte</td>
<td>Byte 2 of PGN being requested</td>
<td>0 to 255</td>
</tr>
<tr>
<td>3</td>
<td>1 Byte</td>
<td>Byte 3 of PGN being requested (MSB)</td>
<td>0</td>
</tr>
</tbody>
</table>
<p>The following are the supported PGN&#39;s that can be requested from the Touch Encoder. If the request is unsupported, the device responds with a NACK (Refer to J1939-21).</p>
<h3 id="421-ecu-identification-information-coming-soon">4.2.1 ECU Identification Information (COMING SOON)</h3>
<pre><code>Priority – 0b110 (6)
R/DP – 0b00 (0)
PF – 0xFD (253), ECU ID, Proprietary B PDU2 Format
PS – 0xC5 (197)?
SrcAddr – 0xF2 (242), i.e. Touch Encoder source address
ID – 0x18FDC5F2
Direction – Transmit
Data Length – Variable
Transmission Rate – Upon Request
Multi Packet Transerred – Yes, BAM only
</code></pre>
<table>
<thead>
<tr>
<th>Start</th>
<th>Length</th>
<th>Desc.</th>
<th>Values *</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>&lt;=64</td>
<td>ECU Part Number</td>
<td>Ex. "3KYY1001-1"</td>
</tr>
<tr>
<td>Variable</td>
<td>&lt;=64</td>
<td>ECU Serial Number</td>
<td>Ex. "123456"</td>
</tr>
<tr>
<td>Variable</td>
<td>&lt;=64</td>
<td>ECU Location</td>
<td>Ex. "CAB"</td>
</tr>
<tr>
<td>Variable</td>
<td>&lt;=64</td>
<td>ECU Type</td>
<td>Ex. "KEYPAD"</td>
</tr>
</tbody>
</table>
<p>*All fields "*" ASCII delimited</p>
<h3 id="422-software-identification">4.2.2 Software Identification</h3>
<pre><code>Priority – 0b110 (6)
R/DP – 0b00 (0)
PF – 0xFE (254), SW ID, Proprietary B PDU2 Format
PS – 0xDA (218)
SrcAddr – 0xF2 (242), i.e. Touch Encoder source address
ID – 0x18FEDAF2
Direction – Transmit
Data Length – Variable, 13-100 bytes
Transmission Rate – Upon Request
Multi Packet Transferred – Yes, BAM only
</code></pre>
<table>
<thead>
<tr>
<th>Start</th>
<th>Length</th>
<th>Desc.</th>
<th>Values</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>1 Byte</td>
<td>Number of software fields</td>
<td>2 (FW &amp; bootloader only)</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td>3 (TE Project version available)</td>
</tr>
<tr>
<td>2</td>
<td>5-N Bytes</td>
<td>Firmware version # (Major.Minor.Patch) (ASCII)</td>
<td>Ex. "4.3.1"</td>
</tr>
<tr>
<td>Variable</td>
<td>5-N Bytes</td>
<td>Bootloader version # (Major.Minor.Patch) (ASCII)</td>
<td>Ex. "7.5.3"</td>
</tr>
<tr>
<td>Variable</td>
<td>0-N Bytes</td>
<td>TE Project version # (Major.Minor.Patch) (ASCII) (optional)</td>
<td>Ex. "1.0.1"</td>
</tr>
</tbody>
</table>
<p>*All fields "*" ASCII delimited</p>
<h2 id="43-acknowledgement-message">4.3 Acknowledgement Message</h2>
<pre><code>Priority – 0b110 (6)
R/DP – 0b00 (0)
PF – 0xE8 (232), SW ID, Proprietary A PDU1 Format
PS – 0x22 (34), i.e. example destination address?
SrcAddr – 0xF2 (242), i.e. Touch Encoder source address
ID – 0x18E822F2
Direction – Transmit
Data Length – 8 bytes
Priority – 6
Transmission Rate – Upon appropriate response
</code></pre>
<table>
<thead>
<tr>
<th>Start</th>
<th>Length</th>
<th>Desc.</th>
<th>Values</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>1 Byte</td>
<td>Control Byte</td>
<td>0 = Positive Acknowledgement</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td>1 = Negative Acknowledgement</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td>2 = Access Denied</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td>3 = Cannot Respond</td>
</tr>
<tr>
<td>2</td>
<td>1 Byte</td>
<td>Group Function</td>
<td>Refer to SAE-J1939-21</td>
</tr>
<tr>
<td>3-5</td>
<td>3 Bytes</td>
<td>Reserved by SAE</td>
<td></td>
</tr>
<tr>
<td>6-8</td>
<td>3 Bytes</td>
<td>Parameter Group being Acknowledged</td>
<td></td>
</tr>
</tbody>
</table>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="hidusb.html" class="btn btn-neutral float-right" title="HID USB">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../firmware/development/development.html" class="btn btn-neutral" title="DEVELOPMENT"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../firmware/development/development.html" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="hidusb.html" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme.js" defer></script>
      <script src="../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
